# DNEWS
# DeepNews 应用程序框架构思
围绕“完整新闻事件流追踪”，以关键词为起点，通过B站视频数据采集、文本解析、LLM智能决策，最终输出结构化事件网页，核心解决“新闻碎片化”“信息不完整”“多源内容整合”问题。

## 整体架构分层（自顶向下）
架构遵循“模块化解耦”原则，各层通过标准化接口通信，支持后续扩展（如新增数据源、替换LLM模型）。

| 层级                | 核心职责                                  | 对应原流程步骤 |
|---------------------|-------------------------------------------|----------------|
| 交互与配置层        | 关键词设置、用户反馈、系统配置            | 步骤1          |
| 数据采集层          | B站视频精准抓取（元数据+视频文件）        | 步骤2          |
| 内容解析层          | 视频文字提取与标准化处理                  | 步骤3          |
| 智能决策与聚合层    | 信息完整性判断、补充搜集、事件流整合      | 步骤4、5       |
| 输出与展示层        | 结构化网页模板生成与可视化                | 步骤6          |
| 支撑层              | LLM服务封装、存储、监控、合规保障         | -              |

## 各层级详细设计
### 一、交互与配置层
#### 核心职责
- 接收用户关键词输入，提供关键词优化建议；
- 支持用户查看事件追踪进度、反馈信息完整性；
- 管理系统核心配置（如抓取频率、LLM模型选择、可信度阈值）。

#### 关键组件
1. 关键词管理模块：支持关键词新增、修改、删除，关联历史事件；
2. 优化建议模块：基于LLM的关键词扩展与去歧义；
3. 用户反馈模块：接收“事件不完整”“信息错误”等反馈，触发流程重试；
4. 配置面板：可视化调整系统参数（无需改代码）。

#### LLM融入点
- 关键词扩展：用户输入核心关键词（如“某地地震”），LLM生成相关扩展词（“某地地震 伤亡人数”“某地地震 救援进展”“某地地震 官方通报”），避免遗漏关键信息；
- 歧义排除：针对多义关键词（如“苹果 发布”），LLM结合“新闻场景”询问用户是否限定领域（“科技产品发布”“农业政策发布”）；
- 配置推荐：根据用户关键词热度，LLM推荐合理的抓取频率（如热点事件建议1小时/次，冷门事件建议24小时/次）。

### 二、数据采集层
#### 核心职责
- 基于关键词精准抓取B站相关视频，平衡“覆盖度”与“效率”；
- 合规存储视频元数据与文件，避免冗余抓取。

#### 关键组件
1. B站数据源适配模块：支持官方API（优先）、合规爬虫（API受限场景）双模式；
2. 视频筛选模块：基于元数据预过滤无关视频；
3. 增量抓取模块：记录已抓取视频ID，避免重复下载；
4. 存储调度模块：分类型存储（元数据→关系库，视频文件→对象存储）。

#### LLM融入点
- 元数据预筛选：对视频标题、简介、标签进行语义分析，LLM判断“与关键词的相关度”（如阈值设为0.7，低于则跳过），减少无效抓取；
- 抓取优先级排序：LLM基于视频发布时间、播放量、UP主可信度（是否为权威媒体/领域博主），排序抓取顺序（优先抓取高价值视频）；
- 反爬策略适配：LLM分析B站反爬机制变化（如请求频率限制、验证码触发条件），推荐动态调整抓取间隔。

### 三、内容解析层
#### 核心职责
- 提取视频中的文字信息（字幕/语音转文字）；
- 对文字进行清洗、标准化，为后续分析提供高质量文本。

#### 关键组件
1. 字幕解析模块：解析B站原生字幕（ASS/SRT格式），提取纯文本；
2. ASR语音转文字模块：对无字幕视频，调用ASR服务（如阿里云ASR、本地Whisper）转文字；
3. 文本清洗模块：去除冗余信息（如“嗯”“啊”口语化表达、重复语句）；
4. 结构化提取模块：提取文本中的核心要素（时间、地点、人物、事件）。

#### LLM融入点
- 文本标准化：LLM修正ASR识别错误（如“俄屋冲突”→“俄乌冲突”）、补全指代（如“他表示”→“XX专家表示”）、整合碎片化语句（如将视频中分散的“事件起因”相关表述合并）；
- 关键要素抽取：LLM基于Prompt（如“从以下文本中提取新闻事件的时间、地点、核心人物、起因、经过、结果，格式为JSON”），输出结构化要素，减少后续处理复杂度；
- 低质量文本过滤：LLM判断文本是否为“有效新闻信息”（如纯娱乐吐槽、无实质内容的视频文本），直接过滤以节省资源。

### 四、智能决策与聚合层（核心层）
#### 核心职责
- 判断当前信息是否构成“完整事件流”；
- 若不完整，生成补充搜集指令；
- 若完整，聚合多视频信息，梳理逻辑闭环。

#### 关键组件
1. 完整性判断模块：基于事件要素评估信息缺口；
2. 补充搜集生成模块：生成精准的补充关键词与抓取策略；
3. 事件聚合模块：合并多源信息，去重、调和冲突；
4. 二次校验模块：确认聚合后的事件流完整性与可信度。

#### LLM融入点（核心应用场景）
1. 完整性评估：
   - LLM接收所有视频的结构化要素，按“新闻事件完整度标准”（起因→经过→结果→各方反应→后续影响）逐项检查缺口（如“缺少事件后续处理措施”“未明确伤亡具体人数”）；
   - 输出评估结果：“完整”“需补充XX信息”“信息冲突需验证”。

2. 补充搜集决策：
   - 若需补充，LLM生成针对性关键词（如缺口为“伤亡人数”，则生成“某地地震 伤亡人数 官方通报”）；
   - 推荐抓取范围（如“优先抓取发布时间在24小时内的权威UP主视频”）。

3. 事件聚合与冲突调和：
   - 多源信息合并：LLM将不同视频的相同要素去重（如多个视频均提到“事件发生时间为2025年11月27日”，仅保留一条）；
   - 冲突处理：LLM基于信息来源可信度（UP主资质、是否有官方引用）、时间先后（后续发布的视频可能补充更正信息），判断冲突信息的优先级（如“权威媒体视频的信息＞普通UP主视频”），或标注冲突点（如“关于伤亡人数，A视频称10人，B视频称12人，均未提及官方数据，建议关注后续通报”）。

4. 二次校验：
   - LLM再次审核聚合后的事件流，确认无遗漏缺口、冲突点已处理，输出“可输出”指令。

### 五、输出与展示层
#### 核心职责
- 将聚合后的结构化事件流，生成易读、可视化的网页模板；
- 支持用户查看细节、导出内容。

#### 关键组件
1. 模板引擎模块：内置多套网页模板（简洁版、详细版、时间轴版）；
2. 可视化模块：生成事件时间轴、逻辑关系图；
3. 信息标注模块：标注信息来源（视频链接、UP主、发布时间）与可信度；
4. 导出模块：支持HTML、PDF格式导出。

#### LLM融入点
- 事件概述生成：LLM基于聚合后的事件流，生成100-200字的简洁概述，放在网页顶部；
- 关键亮点提炼：LLM提取事件核心结论、关键数据（如“伤亡人数12人”“救援已覆盖3个乡镇”），突出展示；
- 自然语言润色：将结构化要素转化为流畅的叙述文本（如时间轴上的每个节点，用自然语言描述“2025年11月27日 10:00：某地发生6.0级地震，震源深度10千米”）。

### 六、支撑层（保障系统运行）
#### 核心组件
1. LLM服务封装模块：
   - 支持多LLM模型切换（GPT-4、文心一言、本地LLaMA）；
   - 处理API调用、重试、限流、Prompt模板管理（无需改代码即可调整LLM指令）；
2. 存储系统：
   - 关系库（MySQL）：存储关键词、用户配置、视频元数据；
   - 对象存储（MinIO/OSS）：存储视频文件、网页模板；
   - 搜索引擎（Elasticsearch）：存储解析后的文本，支持快速检索；
   - 文档数据库（MongoDB）：存储事件结构化要素、聚合结果；
3. 监控与日志模块：
   - 监控各阶段成功率（抓取成功率、解析成功率、LLM调用成功率）；
   - 记录错误日志、用户操作日志、LLM决策日志（便于问题排查）；
4. 合规保障模块：
   - 遵守B站robots协议，控制抓取频率，避免过度请求；
   - 视频内容仅用于文本提取，不用于商业用途，标注来源；
   - 过滤违法违规内容（LLM辅助识别敏感信息，直接丢弃相关视频）。

## 核心设计原则
1. **LLM赋能而非替代**：LLM聚焦“语义理解、决策判断、文本处理”，基础功能（抓取、存储、模板渲染）仍用传统技术实现，平衡效率与成本；
2. **增量迭代与闭环**：支持“用户反馈→重新抓取→重新聚合”的闭环（如用户发现事件遗漏，触发系统补充搜集）；
3. **可扩展性**：各层模块化设计，后续可新增数据源（抖音、微博）、输出形式（APP内嵌页、小程序）、LLM模型；
4. **合规优先**：严格遵守平台规则与法律法规，避免数据安全与版权风险；
5. **容错性**：某环节失败（如LLM调用超时、视频解析失败）可降级处理（如重试3次，仍失败则跳过该视频），不影响整体流程。

## 风险与应对策略
| 风险点                  | 应对策略                                                                 |
|-------------------------|--------------------------------------------------------------------------|
| B站反爬机制限制         | 优先使用官方API；爬虫设置动态请求间隔；使用代理池分散IP；监控抓取状态及时调整 |
| ASR识别准确率低         | 结合字幕修正；LLM基于上下文补全；标注低可信度文本，不纳入核心事件流       |
| LLM决策失误（漏判/误判）| 优化Prompt模板（加入few-shot示例）；设置人工审核入口；定期评估LLM准确率并调整 |
| 信息来源不可靠          | 建立UP主可信度评分体系；LLM标注非权威来源信息；冲突信息明确提示用户       |
| 关键词歧义导致抓取偏差  | LLM辅助用户细化关键词；抓取后通过文本解析二次过滤无关视频                 |

## 流程闭环示意图
```
用户设置关键词 → LLM优化关键词 → 数据采集层抓取视频 → 内容解析层提取并清洗文本 → LLM提取结构化要素 → 
LLM判断完整性 → 【不完整】生成补充关键词→重新抓取 → 【完整】聚合事件流→LLM校验 → 输出网页模板 → 
用户查看/反馈 → 【反馈不完整】触发重新流程
```
